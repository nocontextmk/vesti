<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>deef - RSS News Aggregator</title>
    <style>
        /* Modern CSS Reset & Base Styles */
        :root {
            --text-primary: #000000;
            --text-secondary: #444444;
            --text-muted: #666666;
            --background-primary: #ffffff;
            --background-secondary: #f8f9fa;
            --border-color: #eaeaea;
            --accent-color: #1669d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* System Font Stack for Cross-Browser Compatibility */
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 
                       Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--background-primary);
            font-size: 16px;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Layout Components */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Ultra Slim Header */
        .header {
            border-bottom: 1px solid var(--border-color);
            padding: 0.3rem 0;
            margin-bottom: 1rem;
        }

        .logo {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .logo-subtitle {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 0.1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
        }

        /* News List - Minimalist Style */
        .news-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .news-item {
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--border-color);
            text-decoration: none;
            color: inherit;
            display: block;
            transition: background-color 0.1s ease;
        }

        .news-item:hover {
            background-color: var(--background-secondary);
        }

        .news-item:last-child {
            border-bottom: none;
        }

        .news-title {
            font-size: 1.125rem;
            font-weight: 500;
            line-height: 1.4;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .news-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .news-source {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .news-time {
            color: var(--text-muted);
        }

        .news-domain {
            background: var(--background-secondary);
            padding: 0.125rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .loading-spinner {
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Footer */
        .footer {
            border-top: 1px solid var(--border-color);
            padding: 1.5rem 0;
            margin-top: 2rem;
            font-size: 0.75rem;
            color: var(--text-muted);
            background: var(--background-secondary);
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .footer-section {
            margin-bottom: 1rem;
        }

        .footer-section:last-child {
            margin-bottom: 0;
        }

        .footer-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 0.5rem;
        }

        .footer a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive Typography */
        @media (max-width: 768px) {
            body {
                font-size: 15px;
            }
            
            .container {
                padding: 0 16px;
            }
            
            .header {
                padding: 0.25rem 0;
                margin-bottom: 1rem;
            }
            
            .logo {
                font-size: 0.9rem;
            }
            
            .news-item {
                padding: 1.25rem 0;
            }
            
            .news-title {
                font-size: 1.0625rem;
                line-height: 1.375;
            }
            
            .news-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.375rem;
            }

            .footer {
                padding: 1rem 0;
            }
        }

        @media (max-width: 480px) {
            body {
                font-size: 14px;
            }
            
            .header {
                padding: 0.2rem 0;
            }
            
            .logo {
                font-size: 0.85rem;
            }
            
            .logo-subtitle {
                font-size: 0.65rem;
            }
            
            .news-title {
                font-size: 1rem;
            }

            .footer-links {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">deef</div>
            <div class="logo-subtitle">minimal rss reader</div>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            <div class="news-list" id="newsList">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Loading latest news...</div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <strong>Legal Disclaimer & Protection:</strong>
                <p>
                    deef is an <strong>open-source, non-profit educational project</strong> developed for personal learning purposes only. 
                    This application aggregates publicly available RSS feeds and displays them in a minimal, readable format.
                </p>
            </div>

            <div class="footer-section">
                <strong>Copyright & Content Protection:</strong>
                <p>
                    • All RSS feed content belongs to their respective publishers and copyright holders<br>
                    • deef does not claim ownership over any news content or articles<br>
                    • This project merely displays headlines and links to original sources<br>
                    • No content is hosted, stored, or modified by deef<br>
                    • All trademarks and registered trademarks are property of their respective owners
                </p>
            </div>

            <div class="footer-section">
                <strong>Content Removal Requests:</strong>
                <p>
                    If you are a content owner and wish to have your RSS feed removed from this aggregator, 
                    please contact me via GitHub. I respect intellectual property rights and will promptly 
                    address legitimate removal requests.
                </p>
            </div>

            <div class="footer-section">
                <strong>Open Source & Educational Purpose:</strong>
                <p>
                    This is an open-source project built for educational purposes. The code is available 
                    for learning and non-commercial use. deef generates no revenue and operates as a 
                    personal learning project.
                </p>
                
                <div class="footer-links">
                    <a href="https://github.com/your-username/deef" target="_blank" rel="noopener">
                        View Source Code on GitHub
                    </a>
                    <a href="https://github.com/your-username" target="_blank" rel="noopener">
                        Contact via GitHub Profile
                    </a>
                </div>
            </div>

            <div class="footer-section">
                <p>
                    &copy; 2025 deef RSS Aggregator. Built with educational intent. 
                    All external content rights reserved by original publishers.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // RSS feeds configuration
        const rssFeeds = [
            {
                url: "https://feeds.bbci.co.uk/news/business/rss.xml",
                name: "BBC Business",
                copyright: "Content copyright © BBC"
            },
            {
                url: "https://www.forbes.com/business/feed", 
                name: "Forbes Business",
                copyright: "Content copyright © Forbes"
            },
            {
                url: "https://bmmagazine.co.uk/in-business/feed",
                name: "BM Magazine", 
                copyright: "Content copyright © BM Magazine"
            }
        ];

        // Multiple CORS proxies for better reliability and speed
        const corsProxies = [
            "https://api.allorigins.win/raw?url=",
            "https://corsproxy.io/?",
            "https://api.codetabs.com/v1/proxy?quest="
        ];

        // Get the fastest available proxy
        function getFastestProxy() {
            return corsProxies[0]; // Start with first proxy, will failover if needed
        }

        // Simple cache to avoid re-fetching
        const feedCache = new Map();
        const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

        // Format relative time
        function formatTime(date) {
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor(diff / (1000 * 60));
            
            if (minutes < 1) return 'just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            return date.toLocaleDateString();
        }

        // Fast XML parser - optimized version
        function parseRSS(xml, sourceName) {
            const items = [];
            
            // Use regex for faster parsing than DOMParser for simple RSS
            const itemRegex = /<item>([\s\S]*?)<\/item>/gi;
            const entryRegex = /<entry>([\s\S]*?)<\/entry>/gi;
            
            let matches = xml.match(itemRegex) || xml.match(entryRegex) || [];
            
            for (let match of matches) {
                try {
                    // Fast title extraction
                    let titleMatch = match.match(/<title>([\s\S]*?)<\/title>/i);
                    let title = titleMatch ? titleMatch[1].replace(/<![^>]*>/g, '').trim() : 'No title';
                    
                    // Fast link extraction
                    let linkMatch = match.match(/<link[^>]*>([\s\S]*?)<\/link>|<link[^>]*href="([^"]*)"/i);
                    let link = '#';
                    if (linkMatch) {
                        link = linkMatch[2] || linkMatch[1] || '#';
                    }
                    
                    // Fast date extraction
                    let dateMatch = match.match(/<(pubDate|published|updated|date)>([\s\S]*?)<\/\1>/i);
                    let pubDate = dateMatch ? new Date(dateMatch[2]) : new Date();
                    
                    // Extract domain
                    let domain = 'Source';
                    try {
                        domain = new URL(link).hostname.replace('www.', '').split('.')[0];
                    } catch (e) {
                        domain = sourceName;
                    }
                    
                    items.push({
                        title: title.substring(0, 200), // Limit title length
                        link,
                        pubDate,
                        source: sourceName,
                        domain
                    });
                    
                    // Limit items per feed for performance
                    if (items.length >= 15) break;
                    
                } catch (e) {
                    console.log('Error parsing item:', e);
                }
            }
            
            return items;
        }

        // Fast fetch with timeout and retry
        async function fetchWithTimeout(url, timeout = 8000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeoutId);
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.text();
            } catch (error) {
                clearTimeout(timeoutId);
                throw error;
            }
        }

        // Fetch individual feed with caching
        async function fetchFeed(feed, proxyIndex = 0) {
            const cacheKey = `${feed.url}_${new Date().toDateString()}`;
            const cached = feedCache.get(cacheKey);
            
            if (cached && (Date.now() - cached.timestamp) < CACHE_DURATION) {
                return cached.data;
            }
            
            try {
                const proxy = corsProxies[proxyIndex] || corsProxies[0];
                const feedUrl = `${proxy}${encodeURIComponent(feed.url)}`;
                const text = await fetchWithTimeout(feedUrl, 5000);
                const items = parseRSS(text, feed.name);
                
                // Cache successful result
                feedCache.set(cacheKey, {
                    timestamp: Date.now(),
                    data: items
                });
                
                return items;
            } catch (error) {
                console.error(`Error fetching ${feed.name} with proxy ${proxyIndex}:`, error);
                
                // Try next proxy
                if (proxyIndex < corsProxies.length - 1) {
                    return fetchFeed(feed, proxyIndex + 1);
                }
                
                // Return empty array on complete failure
                return [];
            }
        }

        // Create news item HTML
        function createNewsItem(article) {
            const timeAgo = formatTime(article.pubDate);
            
            return `
                <a href="${article.link}" target="_blank" rel="noopener" class="news-item">
                    <div class="news-title">${article.title}</div>
                    <div class="news-meta">
                        <span class="news-source">${article.source}</span>
                        <span class="news-time">${timeAgo}</span>
                        <span class="news-domain">${article.domain}</span>
                    </div>
                </a>
            `;
        }

        // Progressive loading - show items as they come
        function displayNewsItem(article, newsList) {
            const itemHTML = createNewsItem(article);
            newsList.innerHTML += itemHTML;
        }

        // Load all feeds in parallel with progressive rendering
        async function loadAllFeeds() {
            const newsList = document.getElementById('newsList');
            
            try {
                // Clear and show loading for first load
                if (!newsList.classList.contains('loading-started')) {
                    newsList.classList.add('loading-started');
                } else {
                    // For subsequent loads, clear and show loading indicator
                    newsList.innerHTML = `
                        <div class="loading">
                            <div class="loading-spinner"></div>
                            <div>Refreshing news...</div>
                        </div>
                    `;
                }
                
                // Start all fetches in parallel
                const feedPromises = rssFeeds.map(feed => fetchFeed(feed));
                
                // Clear news list for new content
                newsList.innerHTML = '';
                
                // Process each feed as it completes
                for (let i = 0; i < feedPromises.length; i++) {
                    try {
                        const articles = await feedPromises[i];
                        articles.forEach(article => {
                            displayNewsItem(article, newsList);
                        });
                    } catch (error) {
                        console.error(`Feed ${rssFeeds[i].name} failed:`, error);
                    }
                }
                
                // Sort all items by date (optional - removes progressive feel but better organization)
                setTimeout(() => {
                    const items = Array.from(newsList.children);
                    if (items.length > 0) {
                        items.sort((a, b) => {
                            const timeA = a.querySelector('.news-time').textContent;
                            const timeB = b.querySelector('.news-time').textContent;
                            return timeB.localeCompare(timeA);
                        });
                        
                        // Re-append sorted items
                        items.forEach(item => newsList.appendChild(item));
                    }
                }, 100);
                
            } catch (error) {
                console.error('Error loading feeds:', error);
                newsList.innerHTML = '<div class="loading">Error loading news feeds</div>';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadAllFeeds();
            
            // Fast auto-refresh every 3 minutes
            setInterval(loadAllFeeds, 3 * 60 * 1000);
        });

        // Add quick refresh on visibility change (when user returns to tab)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                // Refresh if older than 5 minutes
                const lastRefresh = feedCache.get('last_refresh');
                if (!lastRefresh || (Date.now() - lastRefresh) > 5 * 60 * 1000) {
                    loadAllFeeds();
                    feedCache.set('last_refresh', Date.now());
                }
            }
        });
    </script>
</body>
</html>
